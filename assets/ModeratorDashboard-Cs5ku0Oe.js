import{c as G,r as l,ad as z,aE as n,aB as i,j as e,U as K,B as W,p as u,D as Y,x as Z,y as U,z as ee,E as se,X as te,aD as ae,a5 as ne,aF as re,N as ce}from"./index-DC1R3hf7.js";import{T as B,a as I,b as d,c as y}from"./tabs-BFUdJ7ow.js";import{T as le,a as ie,b as g,c as o,d as oe,e as r}from"./table-CZlA1Z0M.js";import{E as de,T as A}from"./trash-2-CiIpO_Y2.js";import{C as F}from"./circle-check-Bc03WgRk.js";import{T as M}from"./tag-Cp8QYnR4.js";import{F as me}from"./file-text-iy8iHlhs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=G("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function he(){const[v,w]=l.useState([]),[N,b]=l.useState(!0),[T,$]=l.useState(""),[t,H]=l.useState(null),[V,j]=l.useState(!1),[p,P]=l.useState("all"),{isAdmin:C,isModerator:R}=z();l.useEffect(()=>{_()},[p]);const _=async()=>{try{b(!0);const s=p==="all"?{}:{status:p},{data:a,error:L}=await n.from("content_reports").select("*").match(s).order("created_at",{ascending:!1});if(L)throw L;const X=await Promise.all((a||[]).map(async c=>{const{data:m}=await n.from("profiles").select("full_name, username").eq("id",c.reporter_id).single(),{data:x}=await n.from("profiles").select("full_name, username").eq("id",c.reported_user_id).single();let f="";if(c.content_type==="post"){const{data:h}=await n.from("posts").select("title, content").eq("id",c.content_id).single();f=h?`${h.title}: ${h.content.substring(0,100)}...`:"محتوى غير موجود"}else if(c.content_type==="comment"){const{data:h}=await n.from("comments").select("content").eq("id",c.content_id).single();f=h?h.content.substring(0,150):"تعليق غير موجود"}else f="نوع محتوى غير معروف";return{...c,reporter_name:(m==null?void 0:m.full_name)||(m==null?void 0:m.username)||"مستخدم غير معروف",reported_user_name:(x==null?void 0:x.full_name)||(x==null?void 0:x.username)||"مستخدم غير معروف",content_preview:f||c.details||"بدون محتوى"}}));w(X)}catch(s){console.error("Error fetching reports:",s),i.error("حدث خطأ أثناء جلب البلاغات")}finally{b(!1)}},Q=s=>{H(s),j(!0)},S=async s=>{if(!C()&&!R()){i.error("ليس لديك صلاحية لتنفيذ هذا الإجراء");return}try{const{error:a}=await n.from("content_reports").update({status:"approved"}).eq("id",s);if(a)throw a;t&&(t.content_type==="post"?await n.from("posts").update({is_hidden:!0}).eq("id",t.content_id):t.content_type==="comment"&&await n.from("comments").update({is_hidden:!0}).eq("id",t.content_id)),i.success("تم قبول البلاغ وإزالة المحتوى المخالف"),j(!1),_()}catch(a){console.error("Error approving report:",a),i.error(`حدث خطأ أثناء معالجة البلاغ: ${a.message}`)}},D=async s=>{if(!C()&&!R()){i.error("ليس لديك صلاحية لتنفيذ هذا الإجراء");return}try{const{error:a}=await n.from("content_reports").update({status:"rejected"}).eq("id",s);if(a)throw a;i.success("تم رفض البلاغ والإبقاء على المحتوى"),j(!1),_()}catch(a){console.error("Error rejecting report:",a),i.error(`حدث خطأ أثناء معالجة البلاغ: ${a.message}`)}},E=s=>{switch(s){case"post":return e.jsx(me,{className:"h-4 w-4 mr-2"});case"comment":return e.jsx(ne,{className:"h-4 w-4 mr-2"});case"profile":return e.jsx(ae,{className:"h-4 w-4 mr-2"});case"service":return e.jsx(M,{className:"h-4 w-4 mr-2"});default:return e.jsx(M,{className:"h-4 w-4 mr-2"})}},k=s=>{const a=new Date(s);return new Intl.DateTimeFormat("ar",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)},q=v.filter(s=>{const a=T.toLowerCase();return s.reason.toLowerCase().includes(a)||s.reported_user_name.toLowerCase().includes(a)||s.reporter_name.toLowerCase().includes(a)||s.content_preview.toLowerCase().includes(a)}),J=s=>{switch(s){case"pending":return"قيد الانتظار";case"approved":return"تم الإزالة";case"rejected":return"تم الرفض";default:return s}},O=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-red-100 text-red-800";case"rejected":return"bg-green-100 text-green-800";default:return""}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-red-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"إدارة المحتوى المبلغ عنه"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(K,{placeholder:"بحث...",value:T,onChange:s=>$(s.target.value),className:"w-full sm:w-[200px]"}),e.jsx(B,{value:p,onValueChange:P,children:e.jsxs(I,{children:[e.jsx(d,{value:"all",children:"الكل"}),e.jsx(d,{value:"pending",children:"قيد الانتظار"}),e.jsx(d,{value:"approved",children:"تمت الإزالة"}),e.jsx(d,{value:"rejected",children:"تم الرفض"})]})})]})]}),e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(g,{children:[e.jsx(o,{children:"النوع"}),e.jsx(o,{children:"سبب البلاغ"}),e.jsx(o,{children:"المستخدم المُبلغ"}),e.jsx(o,{children:"المستخدم المُبلغ عنه"}),e.jsx(o,{children:"التاريخ"}),e.jsx(o,{children:"الحالة"}),e.jsx(o,{children:"الإجراءات"})]})}),e.jsx(oe,{children:N?e.jsx(g,{children:e.jsx(r,{colSpan:7,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:"جاري تحميل البلاغات..."})})}):q.length===0?e.jsx(g,{children:e.jsx(r,{colSpan:7,className:"text-center py-10 text-muted-foreground",children:"لا توجد بلاغات مطابقة لمعايير البحث"})}):q.map(s=>e.jsxs(g,{children:[e.jsxs(r,{className:"flex items-center",children:[E(s.content_type),e.jsxs("span",{children:[s.content_type==="post"&&"منشور",s.content_type==="comment"&&"تعليق",s.content_type==="profile"&&"ملف شخصي",s.content_type==="service"&&"خدمة"]})]}),e.jsx(r,{children:s.reason}),e.jsx(r,{children:s.reporter_name}),e.jsx(r,{children:s.reported_user_name}),e.jsx(r,{children:k(s.created_at)}),e.jsx(r,{children:e.jsx(W,{variant:"outline",className:O(s.status),children:J(s.status)})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>Q(s),children:e.jsx(de,{className:"h-4 w-4"})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{variant:"ghost",size:"sm",className:"text-green-600",onClick:()=>D(s.id),children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(u,{variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>S(s.id),children:e.jsx(A,{className:"h-4 w-4"})})]})]})})]},s.id))})]}),e.jsx(Y,{open:V,onOpenChange:j,children:e.jsxs(Z,{className:"max-w-md",children:[e.jsxs(U,{children:[e.jsx(ee,{children:"تفاصيل البلاغ"}),e.jsx(se,{children:"مراجعة المحتوى المبلغ عنه واتخاذ الإجراء المناسب"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"font-medium",children:"نوع المحتوى:"}),e.jsxs("div",{className:"flex items-center",children:[E(t.content_type),e.jsxs("span",{children:[t.content_type==="post"&&"منشور",t.content_type==="comment"&&"تعليق",t.content_type==="profile"&&"ملف شخصي",t.content_type==="service"&&"خدمة"]})]}),e.jsx("div",{className:"font-medium",children:"تاريخ البلاغ:"}),e.jsx("div",{children:k(t.created_at)}),e.jsx("div",{className:"font-medium",children:"المُبلغ:"}),e.jsx("div",{children:t.reporter_name}),e.jsx("div",{className:"font-medium",children:"المُبلغ عنه:"}),e.jsx("div",{children:t.reported_user_name}),e.jsx("div",{className:"font-medium",children:"سبب البلاغ:"}),e.jsx("div",{children:t.reason})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"المحتوى:"}),e.jsx("div",{className:"p-3 border rounded-md bg-muted/30",children:t.content_preview})]}),t.status==="pending"&&e.jsxs(te,{className:"gap-2 sm:gap-0",children:[e.jsxs(u,{variant:"outline",onClick:()=>D(t.id),children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"رفض البلاغ"})]}),e.jsxs(u,{variant:"destructive",onClick:()=>S(t.id),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"إزالة المحتوى"})]})]}),t.status!=="pending"&&e.jsx("div",{className:"p-3 rounded-md bg-muted text-center",children:"تم معالجة هذا البلاغ بالفعل"})]})]})})]})}function Ne(){const[v,w]=l.useState("reports"),{isModerator:N}=z();return N()?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(ce,{}),e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"لوحة تحكم المشرف"}),e.jsxs(B,{value:v,onValueChange:w,children:[e.jsxs(I,{className:"mb-8",children:[e.jsx(d,{value:"reports",children:"إدارة البلاغات"}),e.jsx(d,{value:"users",children:"إدارة المستخدمين"}),e.jsx(d,{value:"content",children:"إدارة المحتوى"})]}),e.jsx(y,{value:"reports",children:e.jsx(he,{})}),e.jsx(y,{value:"users",children:e.jsxs("div",{className:"bg-muted/30 rounded-lg p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"إدارة المستخدمين"}),e.jsx("p",{className:"text-muted-foreground",children:"هذه الميزة ستكون متاحة قريبًا"})]})}),e.jsx(y,{value:"content",children:e.jsxs("div",{className:"bg-muted/30 rounded-lg p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"إدارة المحتوى"}),e.jsx("p",{className:"text-muted-foreground",children:"هذه الميزة ستكون متاحة قريبًا"})]})})]})]})]}):e.jsx(re,{to:"/login",replace:!0})}export{Ne as default};
