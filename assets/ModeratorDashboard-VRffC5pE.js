import{c as q,r as d,ad as J,aw as i,ah as j,j as e,C as O,m as X,n as G,o as K,a as Q,B as W,p as o,D as Y,x as Z,y as U,z as ee,E as se,X as ae,a5 as _,av as te,N as ne}from"./index-B4ruYeIT.js";import{T as A,a as $,b as p,c as D}from"./tabs-CW82RKbJ.js";import{T as re,a as le,b as E,c as h,d as ce,e as u}from"./table-DZa3T16_.js";import{C as ie}from"./circle-alert-QWIvBOUI.js";import{E as de,T as S}from"./trash-2-nDPjmjGj.js";import{F as oe}from"./flag-TPJtoPdt.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=q("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=q("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);function me(){const[f,y]=d.useState([]),[b,t]=d.useState(!0),[a,F]=d.useState(null),[L,w]=d.useState(!1),[g,V]=d.useState("pending"),{user:xe,isModerator:H}=J();d.useEffect(()=>{C()},[g]);const C=async()=>{try{t(!0);const s=g==="all"?{}:{status:g},{data:r,error:l}=await i.from("content_reports").select("*").match(s).order("created_at",{ascending:!1});if(l)throw l;const P=await Promise.all((r||[]).map(async n=>{const{data:m}=await i.from("profiles").select("username, full_name").eq("id",n.reporter_id).single(),{data:x}=await i.from("profiles").select("username, full_name").eq("id",n.reported_user_id).single();let N="";if(n.content_type==="post"||n.content_type==="comment"){const{data:c}=await i.from(n.content_type==="post"?"posts":"comments").select("content").eq("id",n.content_id).single();N=(c==null?void 0:c.content)||""}else if(n.content_type==="profile")N="محتوى غير مناسب في الملف الشخصي";else if(n.content_type==="service"){const{data:c}=await i.from("skills").select("title, description").eq("id",n.content_id).single();N=c?`${c.title}: ${c.description}`:""}return{...n,reporter_name:(m==null?void 0:m.full_name)||(m==null?void 0:m.username)||"مستخدم غير معروف",reported_user_name:(x==null?void 0:x.full_name)||(x==null?void 0:x.username)||"مستخدم غير معروف",content_preview:N||n.details||"بدون محتوى"}}));y(P)}catch(s){console.error("Error fetching reports:",s),j.error("حدث خطأ أثناء جلب البلاغات")}finally{t(!1)}},I=s=>{F(s),w(!0)},v=async(s,r)=>{if(!H()){j.error("ليس لديك صلاحية لتنفيذ هذا الإجراء");return}try{const{error:l}=await i.from("content_reports").update({status:r==="resolve"?"resolved":"rejected"}).eq("id",s);if(l)throw l;r==="resolve"&&a&&(a.content_type==="post"||a.content_type==="comment")&&await i.from(a.content_type==="post"?"posts":"comments").update({is_hidden:!0}).eq("id",a.content_id),j.success(r==="resolve"?"تم تأكيد البلاغ وإخفاء المحتوى المخالف":"تم رفض البلاغ"),w(!1),C()}catch(l){console.error("Error handling report:",l),j.error("حدث خطأ أثناء معالجة البلاغ")}},T=s=>({inappropriate:"محتوى غير لائق",harassment:"تحرش أو مضايقة",spam:"محتوى دعائي مزعج",misleading:"معلومات مضللة",hate_speech:"خطاب كراهية",violence:"تحريض على العنف",other:"سبب آخر"})[s]||s,k=s=>{switch(s){case"post":return e.jsx(_,{className:"h-4 w-4 mr-2"});case"comment":return e.jsx(_,{className:"h-4 w-4 mr-2"});case"profile":return e.jsx(te,{className:"h-4 w-4 mr-2"});case"service":return e.jsx(_,{className:"h-4 w-4 mr-2"});default:return null}},R=s=>({post:"منشور",comment:"تعليق",profile:"ملف شخصي",service:"خدمة"})[s]||s,M=s=>new Date(s).toLocaleDateString("ar",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(O,{children:[e.jsxs(X,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{children:"إدارة البلاغات"})]}),e.jsx(K,{children:"مراجعة بلاغات المستخدمين واتخاذ الإجراءات المناسبة"})]}),e.jsxs(Q,{children:[e.jsxs(A,{value:g,onValueChange:V,className:"w-full",children:[e.jsxs($,{className:"grid grid-cols-3 mb-4",children:[e.jsx(p,{value:"pending",children:"قيد الانتظار"}),e.jsx(p,{value:"resolved",children:"تم الحل"}),e.jsx(p,{value:"all",children:"الكل"})]}),b?e.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"جاري تحميل البيانات..."}):f.length===0?e.jsx("div",{className:"py-10 text-center text-muted-foreground",children:"لا توجد بلاغات"}):e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(E,{children:[e.jsx(h,{children:"النوع"}),e.jsx(h,{children:"السبب"}),e.jsx(h,{children:"المُبلِغ"}),e.jsx(h,{children:"التاريخ"}),e.jsx(h,{children:"الحالة"}),e.jsx(h,{children:"الإجراءات"})]})}),e.jsx(ce,{children:f.map(s=>e.jsxs(E,{children:[e.jsxs(u,{className:"flex items-center",children:[k(s.content_type),e.jsx("span",{children:R(s.content_type)})]}),e.jsx(u,{children:T(s.reason)}),e.jsx(u,{children:s.reporter_name}),e.jsx(u,{children:M(s.created_at)}),e.jsx(u,{children:e.jsxs(W,{variant:"outline",className:`
                          ${s.status==="pending"?"bg-yellow-100 text-yellow-800":""}
                          ${s.status==="resolved"?"bg-green-100 text-green-800":""}
                          ${s.status==="rejected"?"bg-red-100 text-red-800":""}
                        `,children:[s.status==="pending"&&"قيد المراجعة",s.status==="resolved"&&"تم الحل",s.status==="rejected"&&"تم الرفض"]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>I(s),children:e.jsx(de,{className:"h-4 w-4"})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"sm",className:"text-green-600",onClick:()=>v(s.id,"resolve"),children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>v(s.id,"reject"),children:e.jsx(S,{className:"h-4 w-4"})})]})]})})]},s.id))})]})]}),e.jsx(Y,{open:L,onOpenChange:w,children:e.jsxs(Z,{className:"sm:max-w-md",children:[e.jsxs(U,{children:[e.jsx(ee,{children:"تفاصيل البلاغ"}),e.jsx(se,{children:"مراجعة محتوى البلاغ واتخاذ الإجراء المناسب"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"font-medium",children:"نوع المحتوى:"}),e.jsxs("div",{className:"flex items-center",children:[k(a.content_type),R(a.content_type)]}),e.jsx("div",{className:"font-medium",children:"تاريخ البلاغ:"}),e.jsx("div",{children:M(a.created_at)}),e.jsx("div",{className:"font-medium",children:"المُبلِغ:"}),e.jsx("div",{children:a.reporter_name}),e.jsx("div",{className:"font-medium",children:"المُبلَغ عنه:"}),e.jsx("div",{children:a.reported_user_name}),e.jsx("div",{className:"font-medium",children:"سبب البلاغ:"}),e.jsx("div",{children:T(a.reason)})]}),a.details&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"تفاصيل إضافية:"}),e.jsx("div",{className:"p-3 border rounded-md bg-muted/30",children:a.details})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"محتوى البلاغ:"}),e.jsx("div",{className:"p-3 border rounded-md bg-muted/30",children:a.content_preview})]}),a.status==="pending"?e.jsxs(ae,{className:"flex justify-between",children:[e.jsxs(o,{variant:"destructive",onClick:()=>v(a.id,"resolve"),children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"تأكيد البلاغ وإخفاء المحتوى"]}),e.jsxs(o,{variant:"outline",onClick:()=>v(a.id,"reject"),children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"رفض البلاغ"]})]}):e.jsx("div",{className:"p-3 rounded-md bg-muted text-center",children:"تمت معالجة هذا البلاغ بالفعل"})]})]})})]})]})}function ve(){d.useEffect(()=>{document.title="لوحة المشرف | مهارات"},[]);const f=t=>{j.success(`تم الموافقة على المحتوى #${t}`)},y=t=>{j.success(`تم رفض المحتوى #${t}`)},b=[{id:"223",title:"طلب مراجعة مهارة",submittedBy:"محمد أحمد",type:"مهارة",date:"2025-04-22"},{id:"224",title:"طلب مراجعة إعلان",submittedBy:"نورة سعد",type:"إعلان",date:"2025-04-21"}];return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(ne,{}),e.jsx("div",{className:"container py-10",children:e.jsxs("div",{className:"flex flex-col space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"لوحة مشرف المحتوى"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"إدارة ومراجعة محتوى المنصة"})]}),e.jsxs(A,{defaultValue:"reports",className:"w-full",children:[e.jsxs($,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(p,{value:"reports",className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:"البلاغات"})]}),e.jsxs(p,{value:"pending",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:"مراجعة المحتوى"})]})]}),e.jsx(D,{value:"reports",className:"mt-6",children:e.jsx(me,{})}),e.jsx(D,{value:"pending",className:"mt-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"h-5 w-5 text-amber-500"}),e.jsx("h2",{className:"text-xl font-semibold",children:"مراجعة المحتوى"})]}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"مراجعة المهارات والإعلانات قبل نشرها"}),e.jsx("div",{className:"space-y-4",children:b.map(t=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold",children:t.title}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t.date})]}),e.jsxs("div",{className:"text-sm mb-3",children:[e.jsx("span",{className:"text-muted-foreground",children:"قدمه:"})," ",t.submittedBy]}),e.jsxs("div",{className:"text-sm mb-4",children:[e.jsx("span",{className:"text-muted-foreground",children:"النوع:"})," ",t.type]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>f(t.id),className:"flex items-center gap-2",children:e.jsx("span",{children:"موافقة"})}),e.jsx(o,{variant:"destructive",size:"sm",onClick:()=>y(t.id),className:"flex items-center gap-2",children:e.jsx("span",{children:"رفض"})})]})]},t.id))})]})})]})]})})]})}export{ve as default};
