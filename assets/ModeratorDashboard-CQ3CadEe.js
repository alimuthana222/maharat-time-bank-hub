import{c as ue,r as c,ad as W,aE as u,aB as f,j as e,U as se,B as F,p as N,D as ae,x as re,y as te,z as ne,E as ie,X as le,aD as je,a5 as fe,a1 as pe,J as X,L as J,M as G,O as H,Q as w,aF as Z,aC as Ne,a7 as me,aG as ye,N as _e}from"./index-MCgi4oI2.js";import{T as ve,a as ge,b as $,c as Y}from"./tabs-C6k98KHQ.js";import{T as ce,a as de,b,c as x,d as oe,e as o}from"./table-C8pVNhTJ.js";import{E as we,T as K,S as Ce}from"./trash-2-5A7bD2yH.js";import{C as he}from"./circle-check-Bi7I0Vuv.js";import{T as xe}from"./tag-Ca5xsDFs.js";import{F as ee}from"./file-text-XtxLn2pq.js";import{C as be}from"./circle-alert-CGu7_8_J.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ue("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ue("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function ke(){const[T,k]=c.useState([]),[A,R]=c.useState(!0),[q,P]=c.useState(""),[a,V]=c.useState(null),[B,y]=c.useState(!1),[p,Q]=c.useState("all"),{isAdmin:j,isModerator:D}=W();c.useEffect(()=>{_()},[p]);const _=async()=>{try{R(!0);const t=p==="all"?{}:{status:p},{data:d,error:r}=await u.from("content_reports").select("*").match(t).order("created_at",{ascending:!1});if(r)throw r;const i=await Promise.all((d||[]).map(async s=>{const{data:n}=await u.from("profiles").select("full_name, username").eq("id",s.reporter_id).single(),{data:l}=await u.from("profiles").select("full_name, username").eq("id",s.reported_user_id).single();let m="";if(s.content_type==="post"){const{data:v}=await u.from("posts").select("title, content").eq("id",s.content_id).single();m=v?`${v.title}: ${v.content.substring(0,100)}...`:"محتوى غير موجود"}else if(s.content_type==="comment"){const{data:v}=await u.from("comments").select("content").eq("id",s.content_id).single();m=v?v.content.substring(0,150):"تعليق غير موجود"}else m="نوع محتوى غير معروف";return{...s,reporter_name:(n==null?void 0:n.full_name)||(n==null?void 0:n.username)||"مستخدم غير معروف",reported_user_name:(l==null?void 0:l.full_name)||(l==null?void 0:l.username)||"مستخدم غير معروف",content_preview:m||s.details||"بدون محتوى"}}));k(i)}catch(t){console.error("Error fetching reports:",t),f.error("حدث خطأ أثناء جلب البلاغات")}finally{R(!1)}},E=t=>{V(t),y(!0)},L=async t=>{if(!j()&&!D()){f.error("ليس لديك صلاحية لتنفيذ هذا الإجراء");return}try{const{error:d}=await u.from("content_reports").update({status:"approved"}).eq("id",t);if(d)throw d;a&&(a.content_type==="post"?await u.from("posts").update({is_hidden:!0}).eq("id",a.content_id):a.content_type==="comment"&&await u.from("comments").update({is_hidden:!0}).eq("id",a.content_id)),f.success("تم قبول البلاغ وإزالة المحتوى المخالف"),y(!1),_()}catch(d){console.error("Error approving report:",d),f.error(`حدث خطأ أثناء معالجة البلاغ: ${d.message}`)}},S=async t=>{if(!j()&&!D()){f.error("ليس لديك صلاحية لتنفيذ هذا الإجراء");return}try{const{error:d}=await u.from("content_reports").update({status:"rejected"}).eq("id",t);if(d)throw d;f.success("تم رفض البلاغ والإبقاء على المحتوى"),y(!1),_()}catch(d){console.error("Error rejecting report:",d),f.error(`حدث خطأ أثناء معالجة البلاغ: ${d.message}`)}},z=t=>{switch(t){case"post":return e.jsx(ee,{className:"h-4 w-4 mr-2"});case"comment":return e.jsx(fe,{className:"h-4 w-4 mr-2"});case"profile":return e.jsx(je,{className:"h-4 w-4 mr-2"});case"service":return e.jsx(xe,{className:"h-4 w-4 mr-2"});default:return e.jsx(xe,{className:"h-4 w-4 mr-2"})}},M=t=>{const d=new Date(t);return new Intl.DateTimeFormat("ar",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(d)},U=T.filter(t=>{const d=q.toLowerCase();return t.reason.toLowerCase().includes(d)||t.reported_user_name.toLowerCase().includes(d)||t.reporter_name.toLowerCase().includes(d)||t.content_preview.toLowerCase().includes(d)}),O=t=>{switch(t){case"pending":return"قيد الانتظار";case"approved":return"تم الإزالة";case"rejected":return"تم الرفض";default:return t}},I=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-red-100 text-red-800";case"rejected":return"bg-green-100 text-green-800";default:return""}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5 text-red-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"إدارة المحتوى المبلغ عنه"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx(se,{placeholder:"بحث...",value:q,onChange:t=>P(t.target.value),className:"w-full sm:w-[200px]"}),e.jsx(ve,{value:p,onValueChange:Q,children:e.jsxs(ge,{children:[e.jsx($,{value:"all",children:"الكل"}),e.jsx($,{value:"pending",children:"قيد الانتظار"}),e.jsx($,{value:"approved",children:"تمت الإزالة"}),e.jsx($,{value:"rejected",children:"تم الرفض"})]})})]})]}),e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(b,{children:[e.jsx(x,{children:"النوع"}),e.jsx(x,{children:"سبب البلاغ"}),e.jsx(x,{children:"المستخدم المُبلغ"}),e.jsx(x,{children:"المستخدم المُبلغ عنه"}),e.jsx(x,{children:"التاريخ"}),e.jsx(x,{children:"الحالة"}),e.jsx(x,{children:"الإجراءات"})]})}),e.jsx(oe,{children:A?e.jsx(b,{children:e.jsx(o,{colSpan:7,className:"text-center py-10",children:e.jsx("div",{className:"flex justify-center",children:"جاري تحميل البلاغات..."})})}):U.length===0?e.jsx(b,{children:e.jsx(o,{colSpan:7,className:"text-center py-10 text-muted-foreground",children:"لا توجد بلاغات مطابقة لمعايير البحث"})}):U.map(t=>e.jsxs(b,{children:[e.jsxs(o,{className:"flex items-center",children:[z(t.content_type),e.jsxs("span",{children:[t.content_type==="post"&&"منشور",t.content_type==="comment"&&"تعليق",t.content_type==="profile"&&"ملف شخصي",t.content_type==="service"&&"خدمة"]})]}),e.jsx(o,{children:t.reason}),e.jsx(o,{children:t.reporter_name}),e.jsx(o,{children:t.reported_user_name}),e.jsx(o,{children:M(t.created_at)}),e.jsx(o,{children:e.jsx(F,{variant:"outline",className:I(t.status),children:O(t.status)})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>E(t),children:e.jsx(we,{className:"h-4 w-4"})}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"ghost",size:"sm",className:"text-green-600",onClick:()=>S(t.id),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(N,{variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>L(t.id),children:e.jsx(K,{className:"h-4 w-4"})})]})]})})]},t.id))})]}),e.jsx(ae,{open:B,onOpenChange:y,children:e.jsxs(re,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(ne,{children:"تفاصيل البلاغ"}),e.jsx(ie,{children:"مراجعة المحتوى المبلغ عنه واتخاذ الإجراء المناسب"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"font-medium",children:"نوع المحتوى:"}),e.jsxs("div",{className:"flex items-center",children:[z(a.content_type),e.jsxs("span",{children:[a.content_type==="post"&&"منشور",a.content_type==="comment"&&"تعليق",a.content_type==="profile"&&"ملف شخصي",a.content_type==="service"&&"خدمة"]})]}),e.jsx("div",{className:"font-medium",children:"تاريخ البلاغ:"}),e.jsx("div",{children:M(a.created_at)}),e.jsx("div",{className:"font-medium",children:"المُبلغ:"}),e.jsx("div",{children:a.reporter_name}),e.jsx("div",{className:"font-medium",children:"المُبلغ عنه:"}),e.jsx("div",{children:a.reported_user_name}),e.jsx("div",{className:"font-medium",children:"سبب البلاغ:"}),e.jsx("div",{children:a.reason})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"المحتوى:"}),e.jsx("div",{className:"p-3 border rounded-md bg-muted/30",children:a.content_preview})]}),a.status==="pending"&&e.jsxs(le,{className:"gap-2 sm:gap-0",children:[e.jsxs(N,{variant:"outline",onClick:()=>S(a.id),children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"رفض البلاغ"})]}),e.jsxs(N,{variant:"destructive",onClick:()=>L(a.id),children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"إزالة المحتوى"})]})]}),a.status!=="pending"&&e.jsx("div",{className:"p-3 rounded-md bg-muted text-center",children:"تم معالجة هذا البلاغ بالفعل"})]})]})})]})}function Le(){const[T,k]=c.useState([]),[A,R]=c.useState(!0),[q,P]=c.useState(""),[a,V]=c.useState(null),[B,y]=c.useState(!1),[p,Q]=c.useState("all"),[j,D]=c.useState(""),[_,E]=c.useState(!1),{isAdmin:L,isOwner:S}=W();c.useEffect(()=>{z()},[p]);const z=async()=>{try{R(!0);const{data:r,error:i}=await u.from("profiles").select("id, username, full_name, university, created_at");if(i)throw i;const s=await Promise.all((r||[]).map(async l=>{const{data:m}=await u.from("user_roles").select("role").eq("user_id",l.id),v=(m||[]).map(g=>g.role);return{...l,roles:v,status:"active"}}));let n=s;p!=="all"&&(n=s.filter(l=>l.status===p)),k(n)}catch(r){console.error("Error fetching users:",r),f.error(`حدث خطأ أثناء جلب المستخدمين: ${r.message}`)}finally{R(!1)}},M=r=>{V(r),y(!0),D("")},U=async()=>{if(!(!a||!j))try{if(E(!0),a.roles.includes(j)){f.info("المستخدم لديه هذا الدور بالفعل"),E(!1);return}const{error:i}=await u.from("user_roles").insert({user_id:a.id,role:j});if(i)throw i;V({...a,roles:[...a.roles,j]}),k(T.map(s=>s.id===a.id?{...s,roles:[...s.roles,j]}:s)),f.success(`تم تعيين دور ${j} للمستخدم بنجاح`)}catch(r){console.error("Error assigning role:",r),f.error(`حدث خطأ أثناء تعيين الدور: ${r.message}`)}finally{E(!1)}},O=async r=>{if(a){if(!L()&&!S()){f.error("ليس لديك صلاحية لتنفيذ هذا الإجراء");return}try{E(!0);const{error:i}=await u.from("user_roles").delete().eq("user_id",a.id).eq("role",r);if(i)throw i;V({...a,roles:a.roles.filter(s=>s!==r)}),k(T.map(s=>s.id===a.id?{...s,roles:s.roles.filter(n=>n!==r)}:s)),f.success(`تم إزالة دور ${r} من المستخدم بنجاح`)}catch(i){console.error("Error removing role:",i),f.error(`حدث خطأ أثناء إزالة الدور: ${i.message}`)}finally{E(!1)}}},I=r=>{const i=new Date(r);return new Intl.DateTimeFormat("ar",{day:"numeric",month:"short",year:"numeric"}).format(i)},t=T.filter(r=>{var s,n,l;const i=q.toLowerCase();return((s=r.username)==null?void 0:s.toLowerCase().includes(i))||((n=r.full_name)==null?void 0:n.toLowerCase().includes(i))||((l=r.university)==null?void 0:l.toLowerCase().includes(i))}),d=r=>{switch(r){case"owner":return"destructive";case"admin":return"default";case"moderator":return"secondary";default:return"outline"}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold",children:"إدارة المستخدمين"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"بحث عن مستخدم...",value:q,onChange:r=>P(r.target.value),className:"pl-10 w-full sm:w-[250px]"})]}),e.jsxs(X,{value:p,onValueChange:Q,children:[e.jsx(J,{className:"w-[160px]",children:e.jsx(G,{placeholder:"حالة المستخدم"})}),e.jsxs(H,{children:[e.jsx(w,{value:"all",children:"جميع المستخدمين"}),e.jsx(w,{value:"active",children:"نشط"}),e.jsx(w,{value:"suspended",children:"معلق"})]})]})]})]}),e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(b,{children:[e.jsx(x,{children:"اسم المستخدم"}),e.jsx(x,{children:"الاسم الكامل"}),e.jsx(x,{children:"الجامعة"}),e.jsx(x,{children:"الأدوار"}),e.jsx(x,{children:"تاريخ التسجيل"}),e.jsx(x,{children:"الحالة"}),e.jsx(x,{children:"الإجراءات"})]})}),e.jsx(oe,{children:A?e.jsx(b,{children:e.jsx(o,{colSpan:7,className:"text-center py-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(Z,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري تحميل المستخدمين..."})]})})}):t.length===0?e.jsx(b,{children:e.jsx(o,{colSpan:7,className:"text-center py-10 text-muted-foreground",children:"لا يوجد مستخدمين مطابقين لمعايير البحث"})}):t.map(r=>e.jsxs(b,{children:[e.jsx(o,{className:"font-medium",children:r.username||"بدون اسم مستخدم"}),e.jsx(o,{children:r.full_name||"غير محدد"}),e.jsx(o,{children:r.university||"غير محدد"}),e.jsx(o,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:r.roles.length>0?r.roles.map(i=>e.jsxs(F,{variant:d(i),children:[i==="owner"&&"مالك",i==="admin"&&"مشرف",i==="moderator"&&"مشرف محتوى",i==="user"&&"مستخدم"]},i)):e.jsx(F,{variant:"outline",children:"مستخدم"})})}),e.jsx(o,{children:I(r.created_at)}),e.jsx(o,{children:e.jsx(F,{variant:r.status==="active"?"success":"destructive",children:r.status==="active"?"نشط":"معلق"})}),e.jsx(o,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>M(r),children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"عرض المستخدم"})]})})})]},r.id))})]}),e.jsx(ae,{open:B,onOpenChange:y,children:e.jsxs(re,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(ne,{children:"تفاصيل المستخدم"}),e.jsx(ie,{children:"عرض وتعديل بيانات المستخدم والصلاحيات"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"font-medium",children:"اسم المستخدم:"}),e.jsx("div",{children:a.username||"غير محدد"}),e.jsx("div",{className:"font-medium",children:"الاسم الكامل:"}),e.jsx("div",{children:a.full_name||"غير محدد"}),e.jsx("div",{className:"font-medium",children:"الجامعة:"}),e.jsx("div",{children:a.university||"غير محدد"}),e.jsx("div",{className:"font-medium",children:"تاريخ التسجيل:"}),e.jsx("div",{children:I(a.created_at)}),e.jsx("div",{className:"font-medium",children:"الحالة:"}),e.jsx("div",{children:e.jsx(F,{variant:a.status==="active"?"success":"destructive",children:a.status==="active"?"نشط":"معلق"})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("div",{className:"font-medium mb-2",children:"الأدوار الحالية:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.roles.length>0?a.roles.map(r=>e.jsxs(F,{variant:d(r),className:"flex items-center gap-1",children:[r==="owner"&&"مالك",r==="admin"&&"مشرف",r==="moderator"&&"مشرف محتوى",r==="user"&&"مستخدم",(L()||S())&&r!=="owner"&&e.jsxs(N,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:()=>O(r),disabled:_,children:[e.jsx(Te,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"إزالة الدور"})]})]},r)):e.jsx(F,{variant:"outline",children:"مستخدم"})})]}),(L()||S())&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("div",{className:"font-medium mb-2",children:"تعيين دور جديد:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{value:j,onValueChange:D,children:[e.jsx(J,{children:e.jsx(G,{placeholder:"اختر دور"})}),e.jsxs(H,{children:[S()&&e.jsx(w,{value:"admin",children:"مشرف"}),(L()||S())&&e.jsx(w,{value:"moderator",children:"مشرف محتوى"})]})]}),e.jsx(N,{onClick:U,disabled:!j||_,size:"sm",children:_?e.jsx(Z,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"تعيين"]})})]}),!S()&&e.jsxs("div",{className:"mt-2 text-xs flex items-center text-muted-foreground",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"فقط المالك يمكنه تعيين دور مشرف"]})]}),e.jsx(le,{className:"gap-2 sm:gap-0",children:e.jsx(N,{variant:"outline",onClick:()=>y(!1),children:"إغلاق"})})]})]})})]})}function Ee(){const[T,k]=c.useState([]),[A,R]=c.useState(!0),[q,P]=c.useState(""),[a,V]=c.useState(null),[B,y]=c.useState(!1),[p,Q]=c.useState("all"),[j,D]=c.useState("all"),[_,E]=c.useState("all"),[L,S]=c.useState([]),{isAdmin:z,isModerator:M}=W();c.useEffect(()=>{O()},[p,j,_]),c.useEffect(()=>{U()},[]);const U=async()=>{try{const{data:s,error:n}=await u.from("posts").select("category").not("category","is",null);if(n)throw n;if(s){const l=Array.from(new Set(s.map(m=>m.category).filter(Boolean)));S(l)}}catch(s){console.error("Error fetching categories:",s)}},O=async()=>{try{R(!0);let s=[],n=[];if(p==="all"||p==="post"){const l=j==="all"?{}:{is_hidden:j==="hidden"},m=_==="all"?{}:{category:_},{data:v,error:g}=await u.from("posts").select("*, user_id").match({...l,...m}).order("created_at",{ascending:!1});if(g)throw g;v&&(s=await Promise.all(v.map(async h=>{const{data:C}=await u.from("profiles").select("full_name, username, university").eq("id",h.user_id).single();return{id:h.id,type:"post",title:h.title,content:h.content,author:{id:h.user_id,name:(C==null?void 0:C.full_name)||(C==null?void 0:C.username)||"مستخدم غير معروف",username:C==null?void 0:C.username,university:C==null?void 0:C.university},created_at:h.created_at,is_hidden:h.is_hidden,category:h.category}})))}if(p==="all"||p==="comment"){const l=j==="all"?{}:{is_hidden:j==="hidden"},{data:m,error:v}=await u.from("comments").select("*, user_id").match(l).order("created_at",{ascending:!1});if(v)throw v;m&&(n=await Promise.all(m.map(async g=>{const{data:h}=await u.from("profiles").select("full_name, username, university").eq("id",g.user_id).single();return{id:g.id,type:"comment",content:g.content,author:{id:g.user_id,name:(h==null?void 0:h.full_name)||(h==null?void 0:h.username)||"مستخدم غير معروف",username:h==null?void 0:h.username,university:h==null?void 0:h.university},created_at:g.created_at,is_hidden:g.is_hidden}})))}k([...s,...n])}catch(s){console.error("Error fetching content:",s),f.error(`حدث خطأ أثناء جلب المحتوى: ${s.message}`)}finally{R(!1)}},I=s=>{V(s),y(!0)},t=async(s,n,l)=>{if(!z()&&!M()){f.error("ليس لديك صلاحية لتنفيذ هذا الإجراء");return}try{const m=n==="post"?"posts":"comments",{error:v}=await u.from(m).update({is_hidden:!l}).eq("id",s);if(v)throw v;k(T.map(g=>g.id===s&&g.type===n?{...g,is_hidden:!l}:g)),a&&a.id===s&&V({...a,is_hidden:!l}),f.success(l?"تم إظهار المحتوى بنجاح":"تم إخفاء المحتوى بنجاح")}catch(m){console.error("Error toggling content visibility:",m),f.error(`حدث خطأ أثناء تغيير حالة المحتوى: ${m.message}`)}},d=s=>{const n=new Date(s);return new Intl.DateTimeFormat("ar",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(n)},r=s=>{switch(s){case"post":return e.jsx(ee,{className:"h-4 w-4 mr-2"});case"comment":return e.jsx(fe,{className:"h-4 w-4 mr-2"});default:return null}},i=T.filter(s=>{var l,m;const n=q.toLowerCase();return s.content.toLowerCase().includes(n)||((l=s.title)==null?void 0:l.toLowerCase().includes(n))||s.author.name.toLowerCase().includes(n)||((m=s.category)==null?void 0:m.toLowerCase().includes(n))});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-xl font-bold",children:"إدارة المحتوى"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"بحث في المحتوى...",value:q,onChange:s=>P(s.target.value),className:"pl-10 w-full sm:w-[200px]"})]}),e.jsxs(X,{value:p,onValueChange:Q,children:[e.jsx(J,{className:"w-[150px]",children:e.jsx(G,{placeholder:"نوع المحتوى"})}),e.jsxs(H,{children:[e.jsx(w,{value:"all",children:"الكل"}),e.jsx(w,{value:"post",children:"منشورات"}),e.jsx(w,{value:"comment",children:"تعليقات"})]})]}),e.jsxs(X,{value:j,onValueChange:D,children:[e.jsx(J,{className:"w-[150px]",children:e.jsx(G,{placeholder:"الحالة"})}),e.jsxs(H,{children:[e.jsx(w,{value:"all",children:"الكل"}),e.jsx(w,{value:"visible",children:"ظاهر"}),e.jsx(w,{value:"hidden",children:"مخفي"})]})]}),p!=="comment"&&L.length>0&&e.jsxs(X,{value:_,onValueChange:E,children:[e.jsx(J,{className:"w-[150px]",children:e.jsx(G,{placeholder:"التصنيف"})}),e.jsxs(H,{children:[e.jsx(w,{value:"all",children:"الكل"}),L.map(s=>e.jsx(w,{value:s,children:s},s))]})]})]})]}),e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(b,{children:[e.jsx(x,{children:"النوع"}),e.jsx(x,{children:"المحتوى"}),e.jsx(x,{children:"الكاتب"}),e.jsx(x,{children:"التاريخ"}),e.jsx(x,{children:"الحالة"}),e.jsx(x,{children:"الإجراءات"})]})}),e.jsx(oe,{children:A?e.jsx(b,{children:e.jsx(o,{colSpan:6,className:"text-center py-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(Z,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"mr-2",children:"جاري تحميل المحتوى..."})]})})}):i.length===0?e.jsx(b,{children:e.jsx(o,{colSpan:6,className:"text-center py-10 text-muted-foreground",children:"لا يوجد محتوى مطابق لمعايير البحث"})}):i.map(s=>e.jsxs(b,{children:[e.jsx(o,{className:"whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[r(s.type),e.jsx("span",{children:s.type==="post"?"منشور":"تعليق"})]})}),e.jsx(o,{className:"max-w-[300px] truncate",children:s.title?e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:s.content})]}):s.content}),e.jsx(o,{children:s.author.name}),e.jsx(o,{className:"whitespace-nowrap",children:d(s.created_at)}),e.jsx(o,{children:e.jsx(F,{variant:s.is_hidden?"destructive":"success",children:s.is_hidden?"مخفي":"ظاهر"})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>I(s),children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"عرض"})]}),e.jsxs(N,{variant:s.is_hidden?"secondary":"destructive",size:"sm",className:"h-8 w-8 p-0",onClick:()=>t(s.id,s.type,s.is_hidden),children:[s.is_hidden?e.jsx(me,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:s.is_hidden?"إظهار":"إخفاء"})]})]})})]},`${s.type}-${s.id}`))})]}),e.jsx(ae,{open:B,onOpenChange:y,children:e.jsxs(re,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(ne,{children:"تفاصيل المحتوى"}),e.jsx(ie,{children:"عرض ومعالجة المحتوى المنشور"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium",children:"النوع:"}),e.jsxs("div",{className:"flex items-center",children:[r(a.type),e.jsx("span",{children:a.type==="post"?"منشور":"تعليق"})]})]}),a.title&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"العنوان:"}),e.jsx("div",{className:"mt-1 text-lg font-semibold",children:a.title})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"المحتوى:"}),e.jsx("div",{className:"mt-1 p-3 rounded-md border bg-muted/30",children:a.content})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"font-medium",children:"الكاتب:"}),e.jsx("div",{children:a.author.name}),a.author.university&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium",children:"الجامعة:"}),e.jsx("div",{children:a.author.university})]}),a.category&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium",children:"التصنيف:"}),e.jsx("div",{children:a.category})]}),e.jsx("div",{className:"font-medium",children:"التاريخ:"}),e.jsx("div",{children:d(a.created_at)}),e.jsx("div",{className:"font-medium",children:"الحالة:"}),e.jsx("div",{children:e.jsx(F,{variant:a.is_hidden?"destructive":"success",children:a.is_hidden?"مخفي":"ظاهر"})})]})]}),e.jsxs(le,{className:"gap-2 sm:gap-0",children:[e.jsx(N,{variant:"outline",onClick:()=>y(!1),children:"إغلاق"}),e.jsx(N,{variant:a.is_hidden?"secondary":"destructive",onClick:()=>t(a.id,a.type,a.is_hidden),children:a.is_hidden?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"إظهار المحتوى"})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"إخفاء المحتوى"})]})})]})]})]})})]})}function Me(){const[T,k]=c.useState("reports"),{isModerator:A}=W();return A()?e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(_e,{}),e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"لوحة تحكم المشرف"}),e.jsxs(ve,{value:T,onValueChange:k,children:[e.jsxs(ge,{className:"mb-8",children:[e.jsx($,{value:"reports",children:"إدارة البلاغات"}),e.jsx($,{value:"users",children:"إدارة المستخدمين"}),e.jsx($,{value:"content",children:"إدارة المحتوى"})]}),e.jsx(Y,{value:"reports",children:e.jsx(ke,{})}),e.jsx(Y,{value:"users",children:e.jsx(Le,{})}),e.jsx(Y,{value:"content",children:e.jsx(Ee,{})})]})]})]}):e.jsx(ye,{to:"/login",replace:!0})}export{Me as default};
